
services:
  # A2A Communications Agent
  communications-agent:
    build:
      context: .
      dockerfile: agents/Dockerfile
      args:
        AGENT_NAME: communications_agent
    ports:
      - "10002:8000"
    env_file: agents/.env
    environment:
      OTEL_EXPORTER_OTLP_ENDPOINT: http://tempo:4318
      OTEL_SERVICE_NAME: communications-agent
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    networks:
      - agentic-network

  # A2A Cross-Selling Agent
  cross-selling-agent:
    build:
      context: .
      dockerfile: agents/Dockerfile
      args:
        AGENT_NAME: cross_selling_agent
    ports:
      - "10003:8000"
    env_file: agents/.env
    environment:
      OTEL_EXPORTER_OTLP_ENDPOINT: http://tempo:4318
      OTEL_SERVICE_NAME: cross-selling-agent
      MCP_CUSTOMER_CRM_URL: http://mcp-customer-crm:8002/mcp
      MCP_INSURANCE_PRODUCTS_URL: http://mcp-insurance-products:8003/mcp
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    networks:
      - agentic-network
    depends_on:
      - mcp-customer-crm
      - mcp-insurance-products
    restart: unless-stopped

  # A2A Stats-Analysis Agent
  stats-analysis-agent:
    build:
      context: .
      dockerfile: agents/Dockerfile
      args:
        AGENT_NAME: stats_analysis_agent
    ports:
      - "10005:8000"
      - "10101:8001"
    env_file: agents/.env
    environment:
      OTEL_EXPORTER_OTLP_ENDPOINT: http://tempo:4318
      OTEL_SERVICE_NAME: stats-analysis-agent
      MCP_CUSTOMER_CRM_URL: http://mcp-customer-crm:8000/mcp
      MCP_INSURANCE_PRODUCTS_URL: http://mcp-insurance-products:8000/mcp
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    command: [ "uv", "run", "adk", "web", "--host", "0.0.0.0", "--port", "8001", "agents/stats_analysis_agent/src" ]
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    networks:
      - agentic-network
    depends_on:
      - mcp-customer-crm
      - mcp-insurance-products
    restart: unless-stopped

  # MCP Server - Customer CRM
  mcp-customer-crm:
    build:
      context: .
      dockerfile: mcp-servers/Dockerfile
      args:
        MCP_SERVER_NAME: customer_crm
    ports:
      - "8002:8000"
    environment:
      - MCP_SERVER_PORT=8002
    networks:
      - agentic-network
    restart: unless-stopped

  # MCP Server - Insurance Products
  mcp-insurance-products:
    build:
      context: .
      dockerfile: mcp-servers/Dockerfile
      args:
          MCP_SERVER_NAME: insurance_products
    ports:
      - "8003:8000"
    environment:
      - MCP_SERVER_PORT=8003
    networks:
      - agentic-network
    restart: unless-stopped

  # A2A Insurance Host Agent
  insurance-host-agent:
    build:
      context: .
      dockerfile: agents/insurance_host_agent/Dockerfile
      args:
        AGENT_NAME: insurance_host_agent
    ports:
      - "10004:8000"
      - "8001:8001"
    env_file: agents/.env
    environment:
      OTEL_EXPORTER_OTLP_ENDPOINT: http://tempo:4318
      OTEL_SERVICE_NAME: insurance-host-agent
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    networks:
      - agentic-network
    command: [ "uv", "run", "adk", "web", "--host", "0.0.0.0", "--port", "8001", "agents/insurance_host_agent/src" ]
    depends_on:
      - communications-agent
      - cross-selling-agent
    restart: unless-stopped

  # Grafana and Grafana Tempo
  tempo:
    image: grafana/tempo:latest
    command: [ "-config.file=/etc/tempo.yaml" ]
    volumes:
      - ./tempo-config.yaml:/etc/tempo.yaml
    ports:
      - "3200:3200"      # Tempo UI
      - "4318:4318"      # OTLP HTTP receiver
    networks:
      - agentic-network

  grafana:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"      # Grafana UI
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
    networks:
      - agentic-network
    depends_on:
      - tempo
    volumes:
      - ./datasource.yaml:/etc/grafana/provisioning/datasources/datasource.yaml

networks:
  agentic-network:
    driver: bridge
