
services:
  # ADK Web UI
  adk-web:
    build:
      context: adk-agents/
    ports:
      - "${ADK_WEB_PORT:-8080}:8080"
    environment:
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    env_file: adk-agents/.env
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    command: ["uv", "run", "adk", "web", "--host", "0.0.0.0", "--port", "8080"]
    networks:
      - agentic-network
    restart: unless-stopped

  # A2A Communications Agent
  communications-agent:
    build:
      context: adk-agents/communications_agent/
    ports:
      - "10002:10002"
    env_file: adk-agents/.env
    environment:
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    networks:
      - agentic-network

  # A2A Cross-Selling Agent
  cross-selling-agent:
    build:
      context: adk-agents/cross_selling_agent/
    ports:
      - "10003:10003"
    env_file: adk-agents/.env
    environment:
      MCP_CUSTOMER_CRM_URL: http://mcp-customer-crm:8002/mcp
      MCP_INSURANCE_PRODUCTS_URL: http://mcp-insurance-products:8003/mcp
      GOOGLE_APPLICATION_CREDENTIALS: /tmp/keys/keyfile.json
    volumes:
      - $HOME/.config/gcloud/application_default_credentials.json:/tmp/keys/keyfile.json:ro
    networks:
      - agentic-network
    depends_on:
      - mcp-customer-crm
      - mcp-insurance-products
    restart: unless-stopped

  # MCP Server - Customer CRM
  mcp-customer-crm:
    build:
      context: .
      dockerfile: mcp-server/Dockerfile
    ports:
      - "${MCP_CUSTOMER_CRM_PORT:-8002}:8002"
    environment:
      - MCP_SERVER_NAME=customer_crm
      - MCP_SERVER_PORT=8002
    command: ["uv", "run", "fastmcp", "run", "-t", "http", "--host", "0.0.0.0", "-p", "8002", "customer_crm/main.py"]
    networks:
      - agentic-network
    restart: unless-stopped

  # MCP Server - Insurance Products
  mcp-insurance-products:
    build:
      context: .
      dockerfile: mcp-server/Dockerfile
    ports:
      - "${MCP_INSURANCE_PRODUCTS_PORT:-8003}:8003"
    environment:
      - MCP_SERVER_NAME=insurance_products
      - MCP_SERVER_PORT=8003
    command: ["uv", "run", "fastmcp", "run", "-t", "http", "--host", "0.0.0.0", "-p", "8003", "insurance_products/main.py"]
    networks:
      - agentic-network
    restart: unless-stopped

networks:
  agentic-network:
    driver: bridge
