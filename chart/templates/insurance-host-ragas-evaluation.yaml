apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: insurance-host-ragas-evaluation
  namespace: testkube
  labels:
      {{ include "showcase-cross-selling.labels" . | nindent 4 }}
spec:
  content:
    files:
      - path: /data/datasets/ragas_dataset.jsonl
        contentFrom:
          configMapKeyRef:
            name: datasets
            key: insurance-host-dataset.jsonl
      - path: /app/config/metrics.yaml
        contentFrom:
          configMapKeyRef:
            name: metrics-config
            key: insurance-host-metrics.yaml

  container:
    env:
      - name: OTEL_EXPORTER_OTLP_ENDPOINT
        valueFrom:
          configMapKeyRef:
            name: otel-config
            key: OTEL_EXPORTER_OTLP_ENDPOINT

  use:
    - name: ragas-run-template
      config:
        agentUrl: "http://insurance-host-agent.showcase-cross-selling:8000"
    - name: ragas-evaluate-template
      config:
        openApiBasePath: "http://ai-gateway.ai-gateway:4000"
        model: "gemini-2.5-flash-lite"
    - name: ragas-publish-template
    - name: ragas-visualize-template