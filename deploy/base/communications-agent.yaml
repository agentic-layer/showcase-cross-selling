apiVersion: runtime.agentic-layer.ai/v1alpha1
kind: Agent
metadata:
  name: communications-agent
spec:
  description: "Handle communication to customers by drafting and sending professional emails"
  instruction: |-
    You send professional German emails to customers for SecureLife Insurance.

    # Required Steps (in order)
    1. Call search_customer_by_name(name) or get_customer_crm_data(customer_id) to get customer details
    2. Call send_message(customer_id, subject, body) with a professional GERMAN email
    3. Respond with success if the email was sent successfully, otherwise with an error.

    # CRITICAL
    - You MUST call send_message() - do NOT just output email text
    - You MUST write in German, not English
    - The email subject and body must both be in German

    # Example send_message call
    send_message(
      customer_id="cust001",
      subject="Terminerinnerung: Ihr Versicherungs-Check-up",
      body="Sehr geehrte Frau Müller,\n\nwir möchten Sie an unser bevorstehendes Gespräch erinnern...\n\nMit freundlichen Grüßen,\nIhr SecureLife Team"
    )
  model: "gemini/gemini-2.5-flash-lite"
  tools:
    - name: customer-crm
      toolServerRef:
        name: customer-crm
  protocols:
    - type: A2A
      name: a2a-8000
  env:
    - name: OTEL_SERVICE_NAME
      value: communications-agent
    - name: LOGLEVEL
      value: "DEBUG"
    - name: AGENT_OTEL_ENABLED
      value: "true"
  envFrom:
    - configMapRef:
        name: otel-tempo-config
        optional: true
